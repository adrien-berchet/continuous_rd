\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb}
\usepackage{amsfonts}
\usepackage{xcolor}
\usepackage[detect-all]{siunitx}
\usepackage{pgfplots}
\usepackage{natbib}
\bibliographystyle{abbrvnat}

\tikzstyle{loosely dashed}=[dash pattern=on 6pt off 6pt]
\usetikzlibrary{patterns, arrows}

\makeatletter
\def\pgfplots@drawtickgridlines@INSTALLCLIP@onorientedsurf#1{}
\makeatother

\begin{document}

\title{Continuous reaction-diffusion process}
\author{Adrien Berchet}

\maketitle

\section*{Introduction}

The skin of oscellated lizards presents labyrinthine pattern that look close to the ones obtained by a quasi-hexagonal probabilistic cellular automaton. This goal of this work is to model the skin color dynamics during the lizards' life using a reaction-diffusion model \citep{Manukyan2017}. The skin of oscellated lizards contains 3 kinds of pigmentary elements: melanophores, xanthophores and iridophores, but the reaction-diffusion model is only applied to melanophores and xanthophores because the contribution of iridophores is neglictible in the process \citep{Nakamasu8429}.

\section{The continuous reaction-diffusion model}

The continuous reaction-diffusion model is represented by the following system of nonlinear partial differential equations \citep{Nakamasu8429}:

\begin{align}
	\dfrac{\partial u}{\partial t} & = F ( u , v , w ) - c_u u + D_u \nabla^2 u \\
	\dfrac{\partial v}{\partial t} & = G ( u , v , w ) - c_v v + D_v \nabla^2 v \\
	\dfrac{\partial w}{\partial t} & = H ( u , v , w ) - c_w w + D_w \nabla^2 w
	\label{rd_eq}
\end{align}
\begin{align}
	F ( u , v , w ) & = \begin{cases} \begin{aligned}
		0, && c_1 v + c_2 w + c_3 < 0 \\
		c_1 v + c_2 w + c_3, && 0 \leq c_1 v + c_2 w + c_3 \leq F_{max} \\
		F_{max}, && F_{max} < c_1 v + c_2 w + c_3
	\end{aligned} \end{cases} \\
	G ( u , v , w ) & = \begin{cases} \begin{aligned}
		0, && c_4 u + c_5 w + c_6 < 0 \\
		c_4 u + c_5 w + c_6, && 0 \leq c_4 u + c_5 w + c_6 \leq G_{max} \\
		G_{max}, && G_{max} < c_4 u + c_5 w + c_6
	\end{aligned} \end{cases} \\
	H ( u , v , w ) & = \begin{cases} \begin{aligned}
		0, && c_7 u + c_8 v + c_9 < 0 \\
		c_7 u + c_8 v + c_9, && 0 \leq c_7 u + c_8 v + c_9 \leq H_{max} \\
		H_{max}, && H_{max} < c_7 u + c_8 v + c_9
	\end{aligned} \end{cases}
	\label{rd_eq_interactions}
\end{align}

In equation \ref{rd_eq}, $u$ and $v$ components represent the densities of melanophores and xanthophores, respectively. The $w$ component represents a long-range factor (diffusion coefficient $D_w$ much larger than $D_u$ and $D_v$ ) produced by melanophores only.
In equation \ref{rd_eq_interactions}, $F$, $G$ and $H$ represents interactions among the chromatophores.

This model is implemented on a $2000 \times 380$ square lattice with step $\epsilon$ using periodic boundary conditions. In order to model the difference of skin thickness inside the skin scales versus their borders, regular hexagonal pattern (with hexagon side length $S$) is superimposed on the regular grid and the diffusion coefficients is reduced at the boundaries of hexagons: the Laplacian is multiplied by a factor $P \sin (\theta)$ at edges intersecting an hexagon boundary with angle $\theta$.

\section{Code implementation details}

The code implementation was guided by the short delay and by the computation time. The delay did not allow to test several libraries so a low level approach was chosen. This choice seems reasonable since only low order laplacian calculation is targeted, so the neighborhoods are quite easy to implement. Furthermore, because of the quite large number of numerical elements, parallele computation is required in order to obtain the results in a decent time. The library Boost::ODEINT, which aims to solve ordinary differential equations, can be coupled with the Thrust library witch is meant to use the GPU for calculation. The Boost::ODEINT library was chosen for its simplicity and its simplicity and because it is very convenient to switch from a numerical scheme to another. In this work, the Runge-Kutta 4 scheme is used. Also, this library has simple mechanisms to monitor temporary results.

Hexagonal lattice generation
Data storing
Post-process scripts in Python

For the sake of simplicity, the results are stored in ASCII files (see format details in 4.3 of \cite{tecplot_dataformat_guide}) at given time steps. Then these files are post-processed using Python scripts in order to compare them to analytical solutions, to display the dynamics of a given set of elements or to transform the results in images.

\section{Validation}

The right-hand side of each component contains 3 terms: an interaction term, a decay term and a diffusion term. The interaction term acts like a source or a sink, depending on the other component values. This first term calculation is trivial and behaves like a dynamic decay term (though it might also increase instead of only decrease), so it is not specifically validated in this report. The two other decay and diffusion terms are validated by comparing their results to analytical values for simple setups that are presented in the following subsections.

\subsection{Diffusion term}

The right-hand side of each component contains a diffusion term for which the analytical solution is known. It is thus possible to validate this term by setting all other terms to zero and by comparing the dynamics to the analytical solution. In this model, a simple diffusion process is obtained if the following constants are set to zero: $c_1, c_2, c_3, c_4, c_5, c_6, c_7, c_8, c_9, c_u, c_v$ and $c_w$.
Also, the term $P \sin (\theta)$ is ignored in this validation process.

In these conditions, each component should follow the equation \ref{eq:diffusion}. for this validation process, the diffusion coefficients are set to the values that will be used later.

\begin{align}
\label{eq:diffusion}
	C_i(r, t)= \dfrac{ \left( 2 \pi \right) ^\frac{N}{2} \sigma^N_i }{ \left[ 4 \pi D_i \left( t + \dfrac{\sigma^2_i}{2D_i} \right) \right]^\frac{N}{2} } \exp \left(- \dfrac{r^2}{4 D_i \left ( t+ \dfrac{\sigma^2_i}{2D_i} \right) } \right)
\end{align}
where $C_i(t)$ is the value of the component $i$, $N$ is the number of dimensions (2 in our case), $D_i$ is the diffusion coefficient for the component $i$, $\sigma_i$ is the standard deviation of the gaussian distribution at $t=0$ for the component $i$ and $r$ is the distance from the center of this gaussian distribution.

\begin{figure}
\begin{tikzpicture}
	\begin{semilogyaxis}[xlabel=Time (s), ylabel=$Err_2$, legend pos=south east]
		\addplot[color=black, solid, mark=none] table[x index=0, y index=1, col sep=comma] {../results/validation/diffusion/errors_diffusion.dat};
		\addlegendentry{u component}
		\addplot[color=black, ultra thick, dashed, mark=none] table[x index=0, y index=2, col sep=comma] {../results/validation/diffusion/errors_diffusion.dat};
		\addlegendentry{v component}
		\addplot[color=black, loosely dashed, mark=none] table[x index=0, y index=3, col sep=comma] {../results/validation/diffusion/errors_diffusion.dat};
		\addlegendentry{w component}
	\end{semilogyaxis}
\end{tikzpicture}
\caption{$L_2$ error of the diffusion process.}
\end{figure}


\subsection{Decay term}

The decay coefficients are set to the values that will be used later.

\begin{figure}
\begin{tikzpicture}
	\begin{semilogyaxis}[xlabel=Time (s), ylabel=$Err_2$, legend pos=north west]
		\addplot[color=black, solid, mark=none] table[x index=0, y index=1, col sep=comma] {../results/validation/decay/errors_decay.dat};
		\addlegendentry{u component}
		\addplot[color=black, ultra thick, dashed, mark=none] table[x index=0, y index=2, col sep=comma] {../results/validation/decay/errors_decay.dat};
		\addlegendentry{v component}
		\addplot[color=black, loosely dashed, mark=none] table[x index=0, y index=3, col sep=comma] {../results/validation/decay/errors_decay.dat};
		\addlegendentry{w component}
	\end{semilogyaxis}
\end{tikzpicture}
\caption{$L_2$ error of the decay process.}
\end{figure}

\section{Results}

\section{Perspectives}

The ASCII file format is not efficient and the result export is very slow. A strong improvement of this process could consist in using binary file format.

\bibliography{biblio.bib}

\listoftables
\listoffigures

\end{document}
